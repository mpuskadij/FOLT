<ui:composition template="/predlozak.xhtml"
	xmlns:ui="jakarta.faces.facelets" xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core">

	<ui:define name="title">Nadzorna konzola partnera/restorana</ui:define>
	<ui:define name="content">

		<h:form id="forma">
			<h:panelGrid columns="2" cellpadding="5">
				<h:outputText
					value="Status poslužitelja za prijem zahtjeva kupaca #{nadzornaKonzolaPartnera.porukaZaDijelove}"></h:outputText>
				
				<br/>


				<h:commandButton
					value="Pauziraj poslužitelja za prijem zahtjeva kupaca!">
					<f:ajax execute="@form" render="forma"
						listener="#{nadzornaKonzolaPartnera.pauziraj}" />
				</h:commandButton>

				<h:commandButton
					value="Pokreni poslužitelja za prijem zahtjeva kupaca!">
					<f:ajax execute="@form" render="@form"
						listener="#{nadzornaKonzolaPartnera.pokreni}" />
				</h:commandButton>
			</h:panelGrid>
			
			<h:commandButton
					value="Završi partnera!">
					<f:ajax execute="@form" render="@form"
						listener="#{nadzornaKonzolaPartnera.zavrsiPartnera}" />
				</h:commandButton>
			


		</h:form>
		
					<h:outputText id="status" value="Status partnera: #{nadzornaKonzolaPartnera.statusPartnera}" styleClass="#{nadzornaKonzolaPartnera.statusPartnera eq 'RADI' ? 'zelena' : 'crvena' }" ></h:outputText>
					<br/>
					<h:outputText id="brojOtvorenihNarudzbi" value="Broj otvorenih narudžbi: #{nadzornaKonzolaPartnera.brojOtvorenihNarudzbi}" ></h:outputText>
					<br/>
					<h:outputText id="brojRacuna" value="Broj računa: #{nadzornaKonzolaPartnera.brojRacuna}" ></h:outputText>
					

		<script type="text/javascript">
			var wsocket;
            var najNovijaPoruka = "";
			function connect() {
				var adresa = window.location.pathname;
				var dijelovi = adresa.split("/");
				adresa = "ws://" + window.location.hostname + ":"
						+ window.location.port + "/" + dijelovi[1]
						+ "/ws/partneri";
				if ('WebSocket' in window) {
					wsocket = new WebSocket(adresa);
				} else if ('MozWebSocket' in window) {
					wsocket = new MozWebSocket(adresa);
				} else {
					alert('WebSocket nije podržan od web preglednika.');
					return;
				}
				wsocket.onmessage = onMessage;
			}

			function onMessage(evt) {
				najNovijaPoruka = evt.data;
				
				var obojanaKutija = document.getElementById("status");
				var dijeloviPoruke = najNovijaPoruka.split(";");
                var statusIzPoruke = dijeloviPoruke[0];
                
                if(statusIzPoruke == "RADI") {
                	obojanaKutija.classList.remove("crvena");
                	obojanaKutija.classList.add("zelena");
                	
                }
                else if (statusIzPoruke == "NE RADI") {
                	obojanaKutija.classList.remove("zelena");
                	obojanaKutija.classList.add("crvena");
                }
                obojanaKutija.innerHTML = "Status poslužitelja partnera: " + statusIzPoruke;
                
				var brojOtvorenihNarudzbi = document.getElementById("brojOtvorenihNarudzbi");
				var brojRacuna = document.getElementById("brojRacuna");
				
				brojOtvorenihNarudzbi.innerHTML = "Broj otvorenih narudžbi: " + dijeloviPoruke[1];
				brojRacuna.innerHTML = "Broj računa: " + dijeloviPoruke[2];
				
			}

			window.addEventListener("load", connect, false);
		</script>
	</ui:define>
	<ui:define name="nav">
	</ui:define>
</ui:composition>